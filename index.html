<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OfertasZ - Chollos Premium üöÄ</title>
  <meta name="description" content="Encuentra las mejores ofertas y chollos de Amazon, Chollometro y m√°s, actualizadas al instante. Ahorra dinero todos los d√≠as con OfertasZ!">
  <meta property="og:title" content="OfertasZ - Chollos Premium üöÄ">
  <meta property="og:description" content="Encuentra las mejores ofertas y chollos de Amazon, Chollometro y m√°s, actualizadas al instante.">
  <meta property="og:image" content="https://emoji.gg/assets/emoji/9146-deal.png">
  <meta name="monetag" content="e8fe6dfaa80fb9c45bf655ac5e43c336">
  <link rel="icon" href="https://emoji.gg/assets/emoji/9146-deal.png" />
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
  body {
    background: #0d1117;
    color: #c9d1d9;
    font-family: sans-serif;
    margin: 0;
    padding: 1rem;
  }

  .contenedor {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 1rem;
  }

  .tarjeta {
    display: flex;
    flex-direction: column;
    background: #161b22;
    border-radius: 10px;
    padding: 0.75rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    transition: transform 0.2s;
    height: 100%;
  }

  .tarjeta:hover {
    transform: scale(1.02);
  }

  .tarjeta img {
    height: 100px;
    object-fit: contain;
    margin-bottom: 0.5rem;
    border-radius: 6px;
  }

  .tarjeta h2 {
    font-size: 0.85rem;
    margin: 0 0 0.2rem;
    color: #58a6ff;
  }

  .tarjeta p {
    font-size: 0.75rem;
    flex-grow: 1;
    margin: 0;
    overflow: hidden;
    max-height: 3.5em;
    line-height: 1.2em;
  }

  .acciones {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.5rem;
  }

  .boton {
    background: #238636;
    color: white;
    border: none;
    padding: 0.4rem 0.7rem;
    border-radius: 5px;
    font-size: 0.75rem;
    cursor: pointer;
  }

  .estrella {
    cursor: pointer;
    font-size: 1.2rem;
    color: #555;
    transition: color 0.2s;
  }

  .estrella.activa {
    color: gold;
  }
</style>

</head>
<body>

  <header>
    <h1>üî• OfertasZ</h1>
    <button class="btn-toggle" onclick="verFavoritos()">‚≠ê Ver favoritos</button>
  </header>

  <input type="text" id="buscador" placeholder="Buscar chollo..." oninput="filtrar()" />

  <div id="ofertas-container"></div>
  <div class="paginacion" id="pagination"></div>

  <footer>
    <p>&copy; 2025 OfertasZ. Todos los derechos reservados. | Hecho con ‚ù§Ô∏è y caf√©</p>
  </footer>

  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTSE7fEFVv-U8Zu1egpFcgj28fSq5KOpaDPbLRCvYLpaM0ERCIvvTRAbXZ6-RzT0Q8SRF7MZoLDWU9y/pub?gid=0&single=true&output=csv";
    const TAG = "tag=imadinho0c-21";
    const PER_PAGE = 20;
    let ofertas = [], pagina = 1, todas = [];

    fetch(SHEET_URL)
      .then(res => res.text())
      .then(csv => {
        ofertas = csv.trim().split("\n").slice(1).map(r => {
          const c = r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(x=>x.replace(/^"|"$/g,"").trim());
          return { titulo:c[0], url:c[1], descripcion:c[2], fecha:c[3], imagen:c[4] };
        }).filter(o=>o.titulo && o.url).reverse();
        todas = [...ofertas];
        renderPagina();
        notificar();
      });

    function renderPagina() {
      const cont = document.getElementById("ofertas-container");
      const start = (pagina-1)*PER_PAGE;
      const pagItems = ofertas.slice(start, start + PER_PAGE);
      cont.innerHTML = pagItems.map(o => tarjetaHTML(o)).join("");
      renderPagination();
    }

  function tarjetaHTML(o) {
  const img = o.imagen?.startsWith("http") ? o.imagen : 'https://via.placeholder.com/250x250?text=Oferta';
  const favs = JSON.parse(localStorage.getItem("favs") || "[]");
  const isFav = favs.includes(o.url);
  return `
    <div class="tarjeta" style="padding:0.5rem; font-size: 0.75rem; height: 280px;">
      <img src="${img}" alt="Imagen oferta" style="height:100px; margin-bottom:0.5rem;" />
      <h2 style="font-size: 0.85rem; margin-bottom:0.2rem; line-height:1.1;">${o.titulo}</h2>
      <p style="flex-grow:1; overflow:hidden; max-height:45px;">${o.descripcion || ""}</p>
      <div class="acciones" style="margin-top:0.5rem;">
        <button class="boton" onclick="ir('${o.url}')">Ver oferta</button>
        <span class="estrella ${isFav ? 'activa' : ''}" onclick="toggleFav(this,'${o.url}')">‚òÖ</span>
      </div>
    </div>
  `;
}


    function renderPagination() {
      const total = Math.ceil(ofertas.length / PER_PAGE);
      let html = '';
      for(let i=1; i<=total; i++) html += `<button onclick="goPage(${i})">${i}</button>`;
      document.getElementById("pagination").innerHTML = html;
    }

    function goPage(n) { pagina = n; renderPagina(); }

    function toggleFav(el,url){
      let favs = JSON.parse(localStorage.getItem("favs")||"[]");
      if(favs.includes(url)) el.classList.remove("activa"), favs=favs.filter(u=>u!==url);
      else el.classList.add("activa"), favs.push(url);
      localStorage.setItem("favs",JSON.stringify(favs));
    }

    function verFavoritos(){
      const favs = JSON.parse(localStorage.getItem("favs")||"[]");
      ofertas = todas.filter(o => favs.includes(o.url));
      pagina = 1;
      renderPagina();
    }

    function ir(url){
      window.open( url.includes("amazon") ? url + (url.includes('?')?'&':'?') + TAG : url, "_blank");
    }

    function filtrar() {
      const query = document.getElementById("buscador").value.toLowerCase();
      ofertas = todas.filter(o => o.titulo.toLowerCase().includes(query) || (o.descripcion && o.descripcion.toLowerCase().includes(query)));
      pagina = 1;
      renderPagina();
    }

    function notificar(){
      if("Notification" in window && Notification.permission !== "granted"){
        Notification.requestPermission().then(p => {
          if(p==='granted'){
            new Notification("üëç ¬°OfertasZ activado!", { body: "Ahora recibir√°s notificaciones de nuevos chollos" });
          }
        });
      }
    }
  </script>
</body>
</html>
