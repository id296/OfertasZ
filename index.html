<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>üî• OfertasZ</title>
<link rel="icon" href="https://i.imgur.com/rB4J0Uq.png"/>
<style>
  :root { --bg:#121212;--card:#1f1f1f;--accent:#00c853;--highlight:gold;--text:#fff; }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:sans-serif;}
  header{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#1e1e1e;}
  .acciones{display:flex;gap:.5rem;}
  .acciones input{padding:.5rem;border:none;border-radius:4px;width:200px;}
  .acciones button{padding:.5rem;border:none;border-radius:4px;background:var(--highlight);cursor:pointer;}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:.5rem;padding:1rem;}
  .tarjeta{background:var(--card);border-radius:6px;padding:.5rem;display:flex;flex-direction:column;justify-content:space-between;position:relative;height:260px;}
  .tarjeta img{width:100%;height:100px;object-fit:contain;margin-bottom:.3rem;}
  .tarjeta h3{font-size:1rem;color:#4caf50;margin:.2rem 0;}
  .tarjeta p{font-size:.85rem;flex-grow:1;overflow:hidden;}
  .boton{background:var(--accent);color:#000;padding:.4rem;border:none;border-radius:4px;cursor:pointer;}
  .estrella{position:absolute;bottom:5px;right:5px;font-size:1.1rem;color:#777;cursor:pointer;}
  .estrella.fav{color:var(--highlight);}
  .pags{padding:1rem;text-align:center;}
  .pags button{margin:.2rem;padding:.4rem .8rem;border:none;border-radius:4px;background:var(--accent);color:#000;cursor:pointer;}
  #popup{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;}
  #popup .c{background:var(--card);padding:1rem;border-radius:8px;text-align:center;}
  #popup button{margin:.5rem;padding:.5rem 1rem;border:none;border-radius:4px;cursor:pointer;}
  #popup .ok{background:var(--accent);color:#000;}
  #popup .close{background:#555;color:#fff;}
  footer{padding:1rem;text-align:center;}
  footer a{color:var(--highlight);text-decoration:underline;}
</style>
</head>
<body>

<header>
  <h1>üî• OfertasZ</h1>
  <div class="acciones">
    <button onclick="toggleFavs()">‚≠ê Favoritos</button>
    <input id="busca" type="text" placeholder="Buscar chollo..." oninput="filtrar(this.value)">
  </div>
</header>

<!-- Native Ad banner -->
<script async data-cfasync="false" src="//pl26928600.profitableratecpm.com/127e1bd4761db0b286576565e38dfc6b/invoke.js"></script>
<div id="container-127e1bd4761db0b286576565e38dfc6b"></div>

<div class="grid" id="grid"></div>
<div class="pags" id="pages"></div>

<!-- Popup destacado -->
<div id="popup">
  <div class="c">
    <p>üéÅ Oferta destacada</p>
    <button class="ok" onclick="redir()">Ver ahora</button>
    <button class="close" onclick="cerrar()">Cerrar</button>
  </div>
</div>

<!-- Monetizaci√≥n Direct Link oculto y visible -->
<iframe src="https://www.profitableratecpm.com/m8cy5uamn?key=3167f395abf1b5799d89f05a7e5e710f" style="display:none"></iframe>
<footer><a href="https://www.profitableratecpm.com/m8cy5uamn?key=3167f395abf1b5799d89f05a7e5e710f" target="_blank">üëâ Enlace Directo Especial</a></footer>

<script>
const SHEET = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTSE7fEFVv-U8Zu1egpFcgj28fSq5KOpaDPbLRCvYLpaM0ERCIvvTRAbXZ6-RzT0Q8SRF7MZoLDWU9y/pub?gid=0&single=true&output=csv";
const TAG="imadinho0c-21", PER=20;
let all=[], filt=[], page=1, favOnly=false;

fetch(SHEET)
  .then(r=>r.text())
  .then(txt=>{
    all = txt.trim().split("\n").slice(1).map(r=>{
      const [t,u,d,f,i] = r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/^"|"$/g,""));
      return {t,u,d,i};
    }).filter(o=>o.t&&o.u).reverse();
    filt=[...all];
    render();
    setTimeout(()=>document.getElementById('popup').style.display='flex',1500);
  })
  .catch(console.error);

function render(){
  const grid=document.getElementById('grid'), start=(page-1)*PER, slice=filt.slice(start,start+PER);
  grid.innerHTML=slice.map(o=>`
    <div class="tarjeta">
      <img src="${o.i||'https://via.placeholder.com/200'}">
      <h3>${o.t}</h3>
      <p>${o.d||''}</p>
      <button class="boton" onclick="window.open('${o.u}','_blank')">Ver oferta</button>
      <span class="estrella ${JSON.parse(localStorage.getItem('favs')||'[]').includes(o.u)?'fav':''}"
        onclick="togFav('${o.u}',this)">‚òÖ</span>
    </div>`).join('');
  const pages = Math.ceil(filt.length/PER);
  document.getElementById('pages').innerHTML =
    Array.from({length:pages},(_,i)=>`<button onclick="go(${i+1})">${i+1}</button>`).join('');
}

function go(n){page=n; render();}
function togFav(u, el){
  let arr=JSON.parse(localStorage.getItem('favs')||'[]');
  arr.includes(u)?arr=arr.filter(x=>x!==u)&el.classList.remove('fav'):arr.push(u)&el.classList.add('fav');
  localStorage.setItem('favs', JSON.stringify(arr));
}
function toggleFavs(){
  favOnly=!favOnly;
  filt=favOnly? all.filter(o=>JSON.parse(localStorage.getItem('favs')||'[]').includes(o.u)) : [...all];
  page=1; render();
}
function filtrar(q){
  filt=all.filter(o=>o.t.toLowerCase().includes(q.toLowerCase())||(o.d&&o.d.toLowerCase().includes(q.toLowerCase())));
  page=1; render();
}
function cerrar(){document.getElementById('popup').style.display='none'}
function redir(){
  const primeiro = all[0]; 
  const url = primeiro.u.includes('amazon.') ? primeiro.u + (primeiro.u.includes('?')?'&':'?') + 'tag='+TAG : primeiro.u;
  window.open(url,'_blank');
}
</script>

</body>
</html>
